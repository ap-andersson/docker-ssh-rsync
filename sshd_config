Port 22
HostKey /config/ssh_host_keys/ssh_host_rsa_key
HostKey /config/ssh_host_keys/ssh_host_ed25519_key

PermitRootLogin no
PubkeyAuthentication yes
PasswordAuthentication no
PermitEmptyPasswords no
ChallengeResponseAuthentication no

# Performance Optimization
LogLevel INFO
PrintMotd no
Subsystem sftp internal-sftp
MaxStartups 100:30:200
PerSourceMaxStartups none

# Security: Rate limiting for failed authentication attempts
MaxAuthTries 3
LoginGraceTime 30

# Prevent potential timing attacks
UseDNS no

# TCP Performance Tuning
TCPKeepAlive yes
ClientAliveInterval 30
ClientAliveCountMax 10

# Prioritize fast ciphers (AES-GCM uses hardware acceleration on modern CPUs)
Ciphers aes128-gcm@openssh.com,aes256-gcm@openssh.com,chacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr

# Use faster MACs
MACs hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,umac-128-etm@openssh.com

# Disable compression - media files are already compressed, so this just wastes CPU
# Enable only if serving primarily text/uncompressed data
Compression no

# Prevent rekeying during large transfers (default 1GB causes pauses)
RekeyLimit 0 0

# Prevent ISP/router throttling based on DSCP markings
IPQoS cs0 cs0

# Security Hardening: Disable tunneling and forwarding
AllowTcpForwarding no
X11Forwarding no
AllowAgentForwarding no

# Uncomment to restrict users to their home directory (Disables Rsync/Shell!)
# Match User *
#     ChrootDirectory %h
#     ForceCommand internal-sftp
#     AllowTcpForwarding no
